<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>집중 헤드헌팅</title>

<style>
body{font-family:sans-serif;background:#111;color:white;padding:20px;}
h2{text-align:center;margin-bottom:5px;}

.subtitle{
text-align:center;
font-size:14px;
color:#aaa;
margin-bottom:20px;
line-height:1.6;
}

.section{
border:1px solid #333;
border-radius:8px;
padding:15px;
margin-bottom:20px;
background:#151515;
}

.resultCard{
background:#1c1c1c;
padding:10px;
border-radius:6px;
margin-bottom:8px;
}

button{
width:120px;
height:38px;
margin:6px;
border:none;
border-radius:6px;
background:#222;
color:white;
cursor:pointer;
}
button:hover{background:#333;}

.infra{color:red;}
.ultra{color:violet;}
.lumen{color:silver;}

.newMark{color:gold;font-weight:bold;}
.groupText{font-size:12px;color:#888;}
.dimmed{color:#666 !important;opacity:0.45;}

.sortBtns{text-align:center;margin-bottom:10px;}

.glowLabel{color:orange;font-weight:bold;}
.glowBtn{
color:gold;
font-weight:bold;
cursor:pointer;
margin-left:6px;
}
.glowBtn:hover{color:orange;}

hr{border:none;border-top:1px solid #333;margin:10px 0;}

/* ===== 팝업 ===== */
.modal{
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.7);
justify-content:center;
align-items:center;
}

.modalContent{
background:#1b1b1b;
padding:20px;
border-radius:8px;
width:80%;
max-height:80%;
overflow:auto;
border:1px solid #444;
}

.modalHeader{
color:orange;
font-weight:bold;
margin-bottom:10px;
}

.closeBtn{
float:right;
cursor:pointer;
color:#aaa;
}
.closeBtn:hover{color:white;}

.exchangeBtn{
width:auto;
height:auto;
padding:4px 8px;
margin-left:8px;
font-size:12px;
background:#333;
}
</style>
</head>

<body>

<h2>[집중 헤드헌팅]</h2>

<div class="subtitle">
쌓아올리는 등불의 벨 에포크<br>
픽업 대상:<br>
<span class="lumen">[LUMEN(★★★)] 발렌티나</span><br>
<span class="ultra">[ULTRA(★★)] 올가</span>
</div>

<!-- 가챠 영역 -->
<div class="section">
<div style="text-align:center;">
<button onclick="pull(1)">1회</button>
<button onclick="pull(10)">10회</button>
</div>
<div id="result"></div>
</div>

<!-- 도감 영역 -->
<div class="section">
총 뽑기 횟수: <span id="totalCount">0</span> |
<span class="glowLabel">잔광: <span id="glowCount">0</span></span>
<button class="glowBtn" onclick="openModal()">잔광 보정</button>
<hr>

<div class="sortBtns">
<button onclick="setSort('grade')">등급별</button>
<button onclick="setSort('name')">가나다순</button>
<button onclick="setSort('group')">소속별</button>
<button onclick="setSort('all')">전체보기</button>
</div>

<div id="collectionArea"></div>
</div>

<div class="section" style="text-align:center;">
<button onclick="resetData()">리셋</button>
</div>

<!-- ===== 잔광 보정 팝업 ===== -->
<div id="glowModal" class="modal">
<div class="modalContent">
<div class="modalHeader">
잔광 보정
<span class="closeBtn" onclick="closeModal()">✕</span>
</div>
<div id="exchangeList"></div>
</div>
</div>

<script>

// ===== DB =====
// (여기에 이전에 사용한 전체 DB 그대로 붙여넣기)
let DB = window.DB || [];

// ===== 상태 =====
let totalCount = parseInt(localStorage.getItem("totalCount"))||0;
let collection = JSON.parse(localStorage.getItem("collection"))||[];
let glow = parseInt(localStorage.getItem("glow"))||0;
let sortMode="grade";

updateUI();

// ===== 유틸 =====
function rollRarity(){
let r=Math.random();
if(r<0.03) return 3;
if(r<0.23) return 2;
return 1;
}
function getGradeText(r){
if(r===3) return "[LUMEN(★★★)]";
if(r===2) return "[ULTRA(★★)]";
return "[INFRA(★)]";
}
function getClass(r){
if(r===3) return "lumen";
if(r===2) return "ultra";
return "infra";
}

// ===== 가챠 =====
function pull(times){

let results=[];
for(let i=0;i<times;i++){
let rarity=rollRarity();
let pool=DB.filter(c=>c.rarity===rarity);
let char=pool[Math.floor(Math.random()*pool.length)];
results.push(char);
}

if(times===10){
if(!results.some(c=>c.rarity>=2)){
let ultraPool=DB.filter(c=>c.rarity===2);
results[9]=ultraPool[Math.floor(Math.random()*ultraPool.length)];
}
}

let html="";

for(let char of results){

totalCount++;
glow++;

let isNew=!collection.includes(char.name);
if(isNew) collection.push(char.name);

html+=`
<div class="resultCard ${getClass(char.rarity)}">
${getGradeText(char.rarity)} ${char.name}
<span class="groupText">(${char.group})</span>
${isNew?'<span class="newMark"> New!</span>':''}
</div>
`;
}

document.getElementById("result").innerHTML=html;

localStorage.setItem("totalCount",totalCount);
localStorage.setItem("collection",JSON.stringify(collection));
localStorage.setItem("glow",glow);

updateUI();
}

// ===== 잔광 팝업 =====
function openModal(){
document.getElementById("glowModal").style.display="flex";
renderExchange();
}
function closeModal(){
document.getElementById("glowModal").style.display="none";
}
function renderExchange(){
let html="";
for(let c of DB){
let cost = c.rarity===3?200:(c.rarity===2?50:null);
if(!cost) continue;
let disabled = glow<cost;
html+=`
<div class="${getClass(c.rarity)}">
${getGradeText(c.rarity)} ${c.name}
<span class="groupText">(${c.group})</span>
<button class="exchangeBtn" onclick="exchange('${c.name}',${cost})"
${disabled?'disabled':''}>
교환 (${cost})
</button>
</div>`;
}
document.getElementById("exchangeList").innerHTML=html;
}
function exchange(name,cost){
if(glow<cost) return;
if(confirm(name+"을(를) 잔광 "+cost+"으로 교환하시겠습니까?")){
glow-=cost;
if(!collection.includes(name)) collection.push(name);
localStorage.setItem("glow",glow);
localStorage.setItem("collection",JSON.stringify(collection));
updateUI();
renderExchange();
}
}

// ===== 정렬 =====
function setSort(mode){sortMode=mode;updateUI();}
function updateUI(){

document.getElementById("totalCount").textContent=totalCount;
document.getElementById("glowCount").textContent=glow;

let owned=DB.filter(c=>collection.includes(c.name));
let html="";

if(sortMode==="all"){
let sorted=[...DB].sort((a,b)=>b.rarity-a.rarity);
for(let c of sorted){
let ownedFlag=collection.includes(c.name);
html+=`
<div class="${getClass(c.rarity)} ${ownedFlag?'':'dimmed'}">
${getGradeText(c.rarity)} ${c.name}
<span class="groupText">(${c.group})</span>
</div>`;
}
}
else{
owned.sort((a,b)=>{
if(sortMode==="name") return a.name.localeCompare(b.name,"ko");
if(sortMode==="group") return a.group.localeCompare(b.group,"ko");
return b.rarity-a.rarity;
});
let currentGroup="";
for(let c of owned){
if(sortMode==="group" && c.group!==currentGroup){
currentGroup=c.group;
html+=`<hr><strong>${currentGroup}</strong><br>`;
}
html+=`
<div class="${getClass(c.rarity)}">
${getGradeText(c.rarity)} ${c.name}
<span class="groupText">(${c.group})</span>
</div>`;
}
}

document.getElementById("collectionArea").innerHTML=html||"없음";
}

// ===== 리셋 =====
function resetData(){
if(confirm("정말로 모든 기록을 초기화하시겠습니까?")){
totalCount=0;
collection=[];
glow=0;
localStorage.clear();
document.getElementById("result").innerHTML="";
updateUI();
}
}
</script>

</body>
</html>
