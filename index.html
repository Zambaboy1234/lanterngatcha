<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>집중 헤드헌팅</title>

<style>
body {
    font-family: sans-serif;
    text-align: center;
    padding: 20px;
    background: #111;
    color: white;
}

button {
    font-size: 18px;
    padding: 8px 18px;
    margin: 8px;
}

.infra { color: red; }
.ultra { color: violet; }
.lumen { color: silver; }

.pickupMark { font-weight: bold; }

.subtitle {
    font-size: 14px;
    color: #aaa;
    margin-top: -10px;
    margin-bottom: 20px;
}

.bannerTitle {
    font-size: 16px;
    color: silver;
}

.stats {
    margin-top: 20px;
    font-size: 14px;
    color: #ccc;
}

.collection {
    margin-top: 10px;
    font-size: 13px;
    color: #bbb;
}

.newMark {
    color: gold;
    font-weight: bold;
}

.resetBtn {
    margin-top: 15px;
    background: #333;
    color: #fff;
    border: 1px solid #555;
}
</style>
</head>

<body>

<h2>[집중 헤드헌팅]</h2>

<div class="subtitle">
<span class="bannerTitle">쌓아올리는 등불의 벨 에포크</span><br>
픽업 대상: [LUMEN(★★★)]발렌티나 / [ULTRA(★★)]올가
</div>

<button onclick="pull(1)">1회</button>
<button onclick="pull(10)">10회</button>

<div id="result"></div>

<div class="stats">
총 뽑기 횟수: <span id="totalCount">0</span>
</div>

<div class="collection">
획득한 캐릭터:<br>
<span id="collectionList">없음</span>
</div>

<button class="resetBtn" onclick="resetData()">리셋</button>

<script>

// ======================
// 캐릭터 DB
// ======================

let DB = [
    {name:"발렌티나", rarity:3, weight:1},
    {name:"백연", rarity:3, weight:1},
    {name:"도로시", rarity:3, weight:1},
    {name:"마리", rarity:3, weight:1},
    {name:"로렌츠", rarity:3, weight:1},

    {name:"올가", rarity:2, weight:1},
    {name:"나모", rarity:2, weight:1},
    {name:"올리버", rarity:2, weight:1},
    {name:"유나", rarity:2, weight:1},
    {name:"암젤", rarity:2, weight:1},
    {name:"니콜라", rarity:2, weight:1},

    {name:"재클린", rarity:1, weight:1},
    {name:"할", rarity:1, weight:1},
    {name:"헤더스", rarity:1, weight:1},
    {name:"프리츠", rarity:1, weight:1},
    {name:"에밀리", rarity:1, weight:1},
    {name:"베르너", rarity:1, weight:1}
];

let PICKUP_3 = "발렌티나";
let PICKUP_2 = "올가";

// ======================
// 저장 데이터 로드
// ======================

let totalCount = parseInt(localStorage.getItem("totalCount")) || 0;
let collection = JSON.parse(localStorage.getItem("collection")) || [];

updateStats();

// ======================
// 픽업 가중치 적용
// ======================

function applyPickupWeights(){
    DB.forEach(c => {
        c.weight = 1;
        if(PICKUP_3 && c.name === PICKUP_3) c.weight = 5;
        if(PICKUP_2 && c.name === PICKUP_2) c.weight = 4;
    });
}
applyPickupWeights();

// ======================
// 기본 확률
// ======================

function rollRarity(){
    let r = Math.random();
    if(r < 0.03) return 3;
    if(r < 0.23) return 2;
    return 1;
}

function weightedRandom(pool){
    let totalWeight = pool.reduce((sum,c)=>sum+c.weight,0);
    let r = Math.random() * totalWeight;
    for(let c of pool){
        if(r < c.weight) return c;
        r -= c.weight;
    }
}

function getClass(rarity){
    if(rarity === 3) return "lumen";
    if(rarity === 2) return "ultra";
    return "infra";
}

function getGradeText(rarity){
    if(rarity === 3) return "[LUMEN(★★★)]";
    if(rarity === 2) return "[ULTRA(★★)]";
    return "[INFRA(★)]";
}

// ======================
// 뽑기
// ======================

function pull(times){

    let results = [];

    for(let i=0;i<times;i++){
        let rarity = rollRarity();
        let pool = DB.filter(c => c.rarity === rarity);
        let char = weightedRandom(pool);
        results.push(char);
    }

    // 10연 보장
    if(times === 10){
        let hasUltraOrHigher = results.some(c => c.rarity >= 2);
        if(!hasUltraOrHigher){
            let ultraPool = DB.filter(c => c.rarity === 2);
            results[9] = weightedRandom(ultraPool);
        }
    }

    let output = "";

    for(let char of results){

        totalCount++;

        let isPickup = (
            (PICKUP_3 && char.name === PICKUP_3) ||
            (PICKUP_2 && char.name === PICKUP_2)
        );

        let isNew = !collection.includes(char.name);
        if(isNew){
            collection.push(char.name);
        }

        output += `<div class="${getClass(char.rarity)} ${isPickup ? 'pickupMark':''}">
        ${getGradeText(char.rarity)} ${char.name}
        ${isPickup ? '[PICK UP]' : ''}
        ${isNew ? '<span class="newMark"> New!</span>' : ''}
        </div>`;
    }

    document.getElementById("result").innerHTML = output;

    localStorage.setItem("totalCount", totalCount);
    localStorage.setItem("collection", JSON.stringify(collection));

    updateStats();
}

// ======================
// 통계 업데이트
// ======================

function updateStats(){
    document.getElementById("totalCount").textContent = totalCount;
    document.getElementById("collectionList").textContent =
        collection.length > 0 ? collection.join(", ") : "없음";
}

// ======================
// 리셋 기능
// ======================

function resetData(){
    let confirmReset = confirm("정말로 모든 기록을 초기화하시겠습니까?");
    if(confirmReset){
        totalCount = 0;
        collection = [];
        localStorage.removeItem("totalCount");
        localStorage.removeItem("collection");
        document.getElementById("result").innerHTML = "";
        updateStats();
    }
}

</script>

</body>
</html>
