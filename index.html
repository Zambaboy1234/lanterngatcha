<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>집중 헤드헌팅</title>

<style>
body{font-family:sans-serif;background:#111;color:white;padding:20px;}
h2{text-align:center;margin-bottom:5px;}
.subtitle{text-align:center;font-size:14px;color:#aaa;margin-bottom:20px;line-height:1.6;}

.section{border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:20px;background:#151515;}
.resultCard{background:#1c1c1c;padding:10px;border-radius:6px;margin-bottom:8px;transition:0.2s;}

button{height:38px;margin:6px;border:none;border-radius:6px;background:#222;color:white;cursor:pointer;padding:0 14px;}
button:hover{background:#333;}
button:disabled{background:#444;color:#777;cursor:not-allowed;}

.infra{color:red;}
.ultra{color:violet;}
.lumen{color:silver;}

.newMark{color:gold;font-weight:bold;}
.groupText{font-size:12px;color:#888;}
.dimmed{color:#666 !important;opacity:0.45;}

.sortBtns{text-align:center;margin-bottom:10px;}

.glowLabel{color:orange;font-weight:bold;}
.glowBtn{color:gold;font-weight:bold;cursor:pointer;}
.glowBtn:hover{color:orange;}

.exchangeRow{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #222;}
.exchangeBtn{height:28px;padding:0 10px;font-size:12px;background:#333;}

hr{border:none;border-top:1px solid #333;margin:10px 0;}

.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;}
.modalContent{background:#1b1b1b;padding:20px;border-radius:8px;width:80%;max-height:80%;overflow:auto;border:1px solid #444;}
.modalHeader{color:orange;font-weight:bold;margin-bottom:10px;}
.closeBtn{float:right;cursor:pointer;color:#aaa;}
.closeBtn:hover{color:white;}

.logNote{font-size:11px;color:#777;margin-bottom:10px;}
.logCard{background:#1c1c1c;border-radius:6px;padding:8px;margin-bottom:14px;}
.logMeta{font-size:11px;color:#aaa;margin-bottom:6px;}

/* ===== 신규 등급별 반짝 ===== */

@keyframes glowRed{
0%{box-shadow:0 0 0px red;}
50%{box-shadow:0 0 18px red;}
100%{box-shadow:0 0 0px red;}
}

@keyframes glowPurple{
0%{box-shadow:0 0 0px violet;}
50%{box-shadow:0 0 18px violet;}
100%{box-shadow:0 0 0px violet;}
}

@keyframes glowSilver{
0%{box-shadow:0 0 0px silver;}
50%{box-shadow:0 0 18px silver;}
100%{box-shadow:0 0 0px silver;}
}

.newInfraEffect{animation:glowRed 0.5s ease-in-out;}
.newUltraEffect{animation:glowPurple 0.5s ease-in-out;}
.newLumenEffect{animation:glowSilver 0.5s ease-in-out;}

</style>
</head>

<body>

<h2>[집중 헤드헌팅]</h2>

<div class="subtitle">
쌓아올리는 등불의 벨 에포크<br>
픽업 대상:<br>
<span class="lumen">[LUMEN(★★★)] 발렌티나</span><br>
<span class="ultra">[ULTRA(★★)] 올가</span>
</div>

<div class="section">
<div style="text-align:center;">
<button id="btn1" onclick="pull(1)">1회</button>
<button id="btn10" onclick="pull(10)">10회</button>
</div>
<div id="result"></div>
</div>

<div class="section">
총 뽑기 횟수: <span id="totalCount">0</span> |
<span class="glowLabel">잔광: <span id="glowCount">0</span></span>
<button class="glowBtn" onclick="openGlow()">잔광 보정</button>
<hr>

<div class="sortBtns">
<button onclick="setSort('grade')">등급별</button>
<button onclick="setSort('name')">가나다순</button>
<button onclick="setSort('group')">소속별</button>
<button onclick="setSort('all')">전체보기</button>
</div>

<div id="collectionArea"></div>
</div>

<div class="section" style="text-align:center;">
<button onclick="openLog()">가챠 기록</button>
<button onclick="resetData()">리셋</button>
</div>

<div id="glowModal" class="modal">
<div class="modalContent">
<div class="modalHeader">
잔광 보정
<span class="closeBtn" onclick="closeGlow()">✕</span>
</div>
<div id="exchangeList"></div>
</div>
</div>

<div id="logModal" class="modal">
<div class="modalContent">
<div class="modalHeader">
가챠 기록
<span class="closeBtn" onclick="closeLog()">✕</span>
</div>
<div class="logNote">최근 200회까지만 표시됩니다.</div>
<div id="logList"></div>
</div>
</div>

<script>

/* ===== DB ===== */
let DB=[{name:"발렌티나",rarity:3,group:"등불사무소"},
{name:"도로시",rarity:3,group:"등불사무소"},
{name:"백연",rarity:3,group:"등불사무소"},
{name:"쿠로세",rarity:3,group:"등불사무소"},
{name:"올가",rarity:2,group:"등불사무소"},
{name:"비아트리스",rarity:3,group:"등불사무소"},
{name:"유나",rarity:2,group:"등불사무소"},
{name:"오웬",rarity:2,group:"등불사무소"},
{name:"할",rarity:1,group:"등불사무소"},
{name:"재클린",rarity:1,group:"등불사무소"},
{name:"마리",rarity:3,group:"아스트론 학파 연구지구"},
{name:"가온",rarity:3,group:"아스트론 학파 연구지구"},
{name:"아이린",rarity:3,group:"아스트론 학파 연구지구"},
{name:"노딘",rarity:3,group:"아스트론 학파 연구지구"},
{name:"니콜라",rarity:2,group:"아스트론 학파 연구지구"},
{name:"로렌츠",rarity:2,group:"아스트론 학파 연구지구"},
{name:"프리츠",rarity:1,group:"아스트론 학파 연구지구"},
{name:"베르너",rarity:1,group:"아스트론 학파 연구지구"},
{name:"셀렌느",rarity:3,group:"하르덴브라흐"},
{name:"마커스",rarity:3,group:"하르덴브라흐"},
{name:"암젤",rarity:2,group:"하르덴브라흐"},
{name:"에밀리",rarity:1,group:"하르덴브라흐"},
{name:"안드레이",rarity:3,group:"66구역"},
{name:"드미트리",rarity:3,group:"66구역"},
{name:"공주",rarity:3,group:"66구역"},
{name:"안나",rarity:2,group:"66구역"},
{name:"모리어티",rarity:3,group:"터미널15"},
{name:"미셸",rarity:3,group:"터미널15"},
{name:"카산드라",rarity:3,group:"터미널15"},
{name:"제럴드",rarity:1,group:"터미널15"},
{name:"루핀",rarity:3,group:"볼칸 중공업"},
{name:"요루",rarity:3,group:"볼칸 중공업"},
{name:"헤더스",rarity:1,group:"볼칸 중공업"},
{name:"올리버",rarity:3,group:"찰스 브리게이드"},
{name:"오지에",rarity:3,group:"찰스 브리게이드"},
{name:"람다",rarity:3,group:"찰스 브리게이드"},
{name:"카롤",rarity:3,group:"찰스 브리게이드"},
{name:"모지",rarity:3,group:"찰스 브리게이드"},
{name:"란",rarity:3,group:"찰스 브리게이드"},
{name:"나모",rarity:2,group:"찰스 브리게이드"},
{name:"엘리아OS",rarity:3,group:"힌튼 아카이브"},
{name:"렌카",rarity:3,group:"미나모토"},
{name:"아토스",rarity:3,group:"미나모토"},
{name:"간류",rarity:3,group:"미나모토"},
{name:"레아",rarity:3,group:"미나모토"},
{name:"로건",rarity:2,group:"미나모토"},
{name:"츠카하라",rarity:1,group:"미나모토"},
{name:"랜슬롯",rarity:3,group:"아발론PMC"},
{name:"케이",rarity:3,group:"아발론PMC"},
{name:"트리스탄",rarity:3,group:"아발론PMC"},
{name:"이졸데",rarity:3,group:"아발론PMC"},
{name:"노미",rarity:3,group:"아발론PMC"},
{name:"가레스",rarity:2,group:"아발론PMC"},
{name:"이졸드",rarity:2,group:"아발론PMC"},
{name:"미래",rarity:3,group:"서천그룹"},
{name:"리",rarity:3,group:"서천그룹"},
{name:"이안",rarity:2,group:"서천그룹"},
{name:"리나",rarity:1,group:"서천그룹"},
{name:"스테파네트",rarity:3,group:"솔레어"},
{name:"뮌하우젠",rarity:2,group:"솔레어"}];

let totalCount=parseInt(localStorage.getItem("totalCount"))||0;
let collection=JSON.parse(localStorage.getItem("collection"))||[];
let glow=parseInt(localStorage.getItem("glow"))||0;
let history=JSON.parse(localStorage.getItem("history"))||[];
let sortMode="grade";
let isRolling=false;

updateUI();

function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function rollRarity(){let r=Math.random();if(r<0.03)return 3;if(r<0.23)return 2;return 1;}
function getGradeText(r){if(r===3)return "[LUMEN(★★★)]";if(r===2)return "[ULTRA(★★)]";return "[INFRA(★)]";}
function getClass(r){if(r===3)return "lumen";if(r===2)return "ultra";return "infra";}

async function pull(times){
if(isRolling)return;
isRolling=true;
document.getElementById("btn1").disabled=true;
document.getElementById("btn10").disabled=true;

let results=[];
for(let i=0;i<times;i++){
let rarity=rollRarity();
let pool=DB.filter(c=>c.rarity===rarity);
results.push(pool[Math.floor(Math.random()*pool.length)]);
}
if(times===10&&!results.some(c=>c.rarity>=2)){
let ultraPool=DB.filter(c=>c.rarity===2);
results[9]=ultraPool[Math.floor(Math.random()*ultraPool.length)];
}

let resultArea=document.getElementById("result");
resultArea.innerHTML="";

for(let char of results){
totalCount++;glow++;
let isNew=!collection.includes(char.name);
if(isNew)collection.push(char.name);

let card=document.createElement("div");
card.className="resultCard "+getClass(char.rarity);
card.innerHTML=`${getGradeText(char.rarity)} ${char.name} <span class="groupText">(${char.group})</span> ${isNew?'<span class="newMark"> New!</span>':''}`;
resultArea.appendChild(card);

await sleep(80);

if(isNew){
await sleep(250);

if(char.rarity===1)card.classList.add("newInfraEffect");
else if(char.rarity===2)card.classList.add("newUltraEffect");
else card.classList.add("newLumenEffect");

await sleep(500);
card.classList.remove("newInfraEffect","newUltraEffect","newLumenEffect");
await sleep(200);
}
}

saveHistory(times,results);
localStorage.setItem("totalCount",totalCount);
localStorage.setItem("collection",JSON.stringify(collection));
localStorage.setItem("glow",glow);
updateUI();

isRolling=false;
document.getElementById("btn1").disabled=false;
document.getElementById("btn10").disabled=false;
}

/* ===== 이하 기존 기능 ===== */

function saveHistory(times,results){
let now=new Date();
let dateStr=now.getFullYear()+"-"+String(now.getMonth()+1).padStart(2,'0')+"-"+String(now.getDate()).padStart(2,'0')+" "+String(now.getHours()).padStart(2,'0')+":"+String(now.getMinutes()).padStart(2,'0');
history.unshift({date:dateStr,count:times,results:results});
if(history.length>200)history=history.slice(0,200);
localStorage.setItem("history",JSON.stringify(history));
}

function openLog(){document.getElementById("logModal").style.display="flex";renderLog();}
function closeLog(){document.getElementById("logModal").style.display="none";}
function renderLog(){
if(history.length===0){document.getElementById("logList").innerHTML="기록 없음";return;}
let html="";
for(let record of history){
html+=`<div class="logCard"><div class="logMeta">${record.date} | ${record.count}회</div>`;
for(let r of record.results){
html+=`<div class="${getClass(r.rarity)}">${getGradeText(r.rarity)} ${r.name} <span class="groupText">(${r.group})</span></div>`;
}
html+="</div>";
}
document.getElementById("logList").innerHTML=html;
}

function openGlow(){document.getElementById("glowModal").style.display="flex";renderExchange();}
function closeGlow(){document.getElementById("glowModal").style.display="none";}
function renderExchange(){
let available=DB.filter(c=>!collection.includes(c.name)&&(c.rarity===2||c.rarity===3));
let html="";
for(let c of available){
let cost=c.rarity===3?200:50;
let disabled=glow<cost;
html+=`<div class="exchangeRow ${getClass(c.rarity)}"><div>${getGradeText(c.rarity)} ${c.name} <span class="groupText">(${c.group})</span></div><button class="exchangeBtn" onclick="exchange('${c.name}',${cost})" ${disabled?'disabled':''}>교환 (${cost})</button></div>`;
}
document.getElementById("exchangeList").innerHTML=html||"교환 가능한 캐릭터 없음";
}
function exchange(name,cost){
if(glow<cost)return;
if(confirm(name+"을(를) 잔광 "+cost+"으로 교환하시겠습니까?")){
glow-=cost;
collection.push(name);
localStorage.setItem("glow",glow);
localStorage.setItem("collection",JSON.stringify(collection));
updateUI();
renderExchange();
}
}

function setSort(mode){sortMode=mode;updateUI();}
function updateUI(){
document.getElementById("totalCount").textContent=totalCount;
document.getElementById("glowCount").textContent=glow;
let owned=DB.filter(c=>collection.includes(c.name));
let html="";
if(sortMode==="all"){
let sorted=[...DB].sort((a,b)=>b.rarity-a.rarity);
for(let c of sorted){
let ownedFlag=collection.includes(c.name);
html+=`<div class="${getClass(c.rarity)} ${ownedFlag?'':'dimmed'}">${getGradeText(c.rarity)} ${c.name} <span class="groupText">(${c.group})</span></div>`;
}
}else{
owned.sort((a,b)=>{if(sortMode==="name")return a.name.localeCompare(b.name,"ko");if(sortMode==="group")return a.group.localeCompare(b.group,"ko");return b.rarity-a.rarity;});
let currentGroup="";
for(let c of owned){
if(sortMode==="group"&&c.group!==currentGroup){currentGroup=c.group;html+=`<hr><strong>${currentGroup}</strong><br>`;}
html+=`<div class="${getClass(c.rarity)}">${getGradeText(c.rarity)} ${c.name} <span class="groupText">(${c.group})</span></div>`;
}
}
document.getElementById("collectionArea").innerHTML=html||"없음";
}

function resetData(){
if(confirm("정말로 모든 가챠 기록과 보유 캐릭터를 초기화하시겠습니까?")){

totalCount=0;
glow=0;
collection=[];
history=[];

// 필요한 키만 개별적으로 초기화
localStorage.setItem("totalCount",0);
localStorage.setItem("glow",0);
localStorage.setItem("collection",JSON.stringify([]));
localStorage.setItem("history",JSON.stringify([]));

document.getElementById("result").innerHTML="";
updateUI();
}
}
</script>

</body>
</html>
